(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-18c21991"],{"030a":function(t,e){t.exports=function(t){t.options.__i18n=t.options.__i18n||[],t.options.__i18n.push('{"en":{"tip":"drag or choose file","download-cover":"download audio cover"},"cn":{"tip":"拖拽或点击上传","download-cover":"下载音频封面"}}'),delete t.options._Ctor}},"45fc":function(t,e,n){"use strict";var s=n("23e7"),a=n("b727").some,i=n("a640"),o=n("ae40"),r=i("some"),c=o("some");s({target:"Array",proto:!0,forced:!r||!c},{some:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}})},5945:function(t,e,n){"use strict";var s=n("030a"),a=n.n(s);e["default"]=a.a},7842:function(t,e,n){"use strict";var s=n("b2c2"),a=n.n(s);a.a},b2c2:function(t,e,n){},c7f0:function(t,e,n){"use strict";n.r(e);var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"upload-plugin-container"},[n("Upload",{style:t.containerStyles,attrs:{type:"drag",action:"/",accept:t.accept,"max-size":t.formData.maxSize,"show-upload-list":!1,format:t.formData.format,"on-exceeded-size":t.handleMaxSize,"on-format-error":t.handleFormatError,"before-upload":t.beforeUpload,"on-success":t.uploadSuccess,"on-error":t.uploadFail}},[n("div",{staticClass:"upload-plugin-area"},[n("Icon",{attrs:{type:"ios-cloud-upload",color:"#888",size:"30"}}),n("span",{staticStyle:{color:"#888"},domProps:{textContent:t._s(t.$t("tip"))}}),n("transition",{attrs:{name:"fade"}},["image"==t.sourceType&&t.needPreview&&t.cachedFile?n("div",{staticClass:"image_previewer",style:[t.containerStyles,t.resultStyles]},[n("img",{attrs:{src:t.fileUrl,alt:""}})]):t._e()]),n("transition",{attrs:{name:"fade"}},["audio"==t.sourceType&&t.cachedFile?n("div",{staticClass:"image_previewer",style:[t.containerStyles,t.resultStyles]},[n("img",{attrs:{src:t.audioInfo.cover||"http://static.dei2.com/images/inig/audio_placeholder.jpg",alt:""}}),t.audioInfo.cover?n("div",{staticClass:"cover_downloader",on:{click:t.downloadCover}},[n("Tooltip",{staticStyle:{wdith:"32px",height:"32px"},attrs:{content:t.$t("download-cover"),placement:"bottom",transfer:!0}},[n("Icon",{staticStyle:{"margin-top":"5px"},attrs:{type:"md-download",color:"#fff",size:"24"}})],1)],1):t._e()]):t._e()])],1)])],1)},a=[],i=(n("a15b"),n("b0c0"),n("a9e3"),n("96cf"),n("1da1")),o=n("5530"),r=n("5867"),c=n("5250"),l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:[t.prefixCls]},[n("div",{class:t.classes,on:{click:t.handleClick,drop:function(e){return e.preventDefault(),t.onDrop(e)},paste:t.handlePaste,dragover:function(e){e.preventDefault(),t.dragOver=!0},dragleave:function(e){e.preventDefault(),t.dragOver=!1}}},[n("input",{ref:"input",class:[t.prefixCls+"-input"],attrs:{type:"file",multiple:t.multiple,accept:t.accept},on:{change:t.handleChange}}),t._t("default")],2),t._t("tip"),t.showUploadList?n("upload-list",{attrs:{files:t.fileList},on:{"on-file-remove":t.handleRemove,"on-file-preview":t.handlePreview}}):t._e()],2)},u=[],d=(n("a623"),n("4160"),n("c975"),n("d81d"),n("fb6a"),n("45fc"),n("a434"),n("d3b7"),n("ac1f"),n("25f0"),n("1276"),n("159b"),n("ade3")),f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ul",{class:[t.prefixCls+"-list"]},t._l(t.files,(function(e){return n("li",{class:t.fileCls(e),on:{click:function(n){return t.handleClick(e)}}},[n("span",{on:{click:function(n){return t.handlePreview(e)}}},[n("Icon",{attrs:{type:t.format(e)}}),t._v(" "+t._s(e.name)+" ")],1),n("Icon",{directives:[{name:"show",rawName:"v-show",value:"finished"===e.status,expression:"file.status === 'finished'"}],class:[t.prefixCls+"-list-remove"],attrs:{type:"ios-close"},nativeOn:{click:function(n){return t.handleRemove(e)}}}),n("transition",{attrs:{name:"fade"}},[e.showProgress?n("i-progress",{attrs:{"stroke-width":2,percent:t.parsePercentage(e.percentage),status:"finished"===e.status&&e.showProgress?"success":"normal"}}):t._e()],1)],1)})),0)},p=[],h=n("099a"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:t.wrapClasses},[n("div",{class:t.outerClasses},[n("div",{class:t.innerClasses},[n("div",{class:t.bgClasses,style:t.bgStyle},[t.textInside?n("div",{staticClass:"ivu-progress-inner-text"},[t._v(t._s(t.percent)+"%")]):t._e()]),n("div",{class:t.successBgClasses,style:t.successBgStyle})])]),t.hideInfo||t.textInside?t._e():n("span",{class:t.textClasses},[t._t("default",[t.isStatus?n("span",{class:t.textInnerClasses},[n("Icon",{attrs:{type:t.statusIcon}})],1):n("span",{class:t.textInnerClasses},[t._v(" "+t._s(t.percent)+"% ")])])],2)])},g=[],v=(n("99af"),n("3a27")),y="ivu-progress",b={name:"Progress",components:{Icon:c["a"]},props:{percent:{type:Number,default:0},successPercent:{type:Number,default:0},status:{validator:function(t){return Object(v["g"])(t,["normal","active","wrong","success"])},default:"normal"},hideInfo:{type:Boolean,default:!1},strokeWidth:{type:Number,default:10},vertical:{type:Boolean,default:!1},strokeColor:{type:[String,Array]},textInside:{type:Boolean,default:!1}},data:function(){return{currentStatus:this.status}},computed:{isStatus:function(){return"wrong"==this.currentStatus||"success"==this.currentStatus},statusIcon:function(){var t="";switch(this.currentStatus){case"wrong":t="ios-close-circle";break;case"success":t="ios-checkmark-circle";break}return t},bgStyle:function(){var t=this.vertical?{height:"".concat(this.percent,"%"),width:"".concat(this.strokeWidth,"px")}:{width:"".concat(this.percent,"%"),height:"".concat(this.strokeWidth,"px")};return this.strokeColor&&("string"===typeof this.strokeColor?t["background-color"]=this.strokeColor:t["background-image"]="linear-gradient(to right, ".concat(this.strokeColor[0]," 0%, ").concat(this.strokeColor[1]," 100%)")),t},successBgStyle:function(){return this.vertical?{height:"".concat(this.successPercent,"%"),width:"".concat(this.strokeWidth,"px")}:{width:"".concat(this.successPercent,"%"),height:"".concat(this.strokeWidth,"px")}},wrapClasses:function(){var t;return["".concat(y),"".concat(y,"-").concat(this.currentStatus),(t={},Object(d["a"])(t,"".concat(y,"-show-info"),!this.hideInfo&&!this.textInside),Object(d["a"])(t,"".concat(y,"-vertical"),this.vertical),t)]},textClasses:function(){return"".concat(y,"-text")},textInnerClasses:function(){return"".concat(y,"-text-inner")},outerClasses:function(){return"".concat(y,"-outer")},innerClasses:function(){return"".concat(y,"-inner")},bgClasses:function(){return"".concat(y,"-bg")},successBgClasses:function(){return"".concat(y,"-success-bg")}},created:function(){this.handleStatus()},methods:{handleStatus:function(t){t?(this.currentStatus="normal",this.$emit("on-status-change","normal")):100==parseInt(this.percent,10)&&(this.currentStatus="success",this.$emit("on-status-change","success"))}},watch:{percent:function(t,e){t<e?this.handleStatus(!0):this.handleStatus()},status:function(t){this.currentStatus=t}}},w=b,x=n("2877"),S=Object(x["a"])(w,m,g,!1,null,null,null),C=S.exports,k="ivu-upload",O={name:"UploadList",components:{Icon:h["a"],iProgress:C},props:{files:{type:Array,default:function(){return[]}}},data:function(){return{prefixCls:k}},methods:{fileCls:function(t){return["".concat(k,"-list-file"),Object(d["a"])({},"".concat(k,"-list-file-finish"),"finished"===t.status)]},handleClick:function(t){this.$emit("on-file-click",t)},handlePreview:function(t){this.$emit("on-file-preview",t)},handleRemove:function(t){this.$emit("on-file-remove",t)},format:function(t){var e=t.name.split(".").pop().toLocaleLowerCase()||"",n="ios-document-outline";return["gif","jpg","jpeg","png","bmp","webp"].indexOf(e)>-1&&(n="ios-image"),["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(e)>-1&&(n="ios-film"),["mp3","wav","wma","ogg","aac","flac"].indexOf(e)>-1&&(n="ios-musical-notes"),["doc","txt","docx","pages","epub","pdf"].indexOf(e)>-1&&(n="md-document"),["numbers","csv","xls","xlsx"].indexOf(e)>-1&&(n="ios-stats"),["keynote","ppt","pptx"].indexOf(e)>-1&&(n="ios-videocam"),n},parsePercentage:function(t){return parseInt(t,10)}}},F=O,_=Object(x["a"])(F,f,p,!1,null,null,null),I=_.exports;function P(t,e,n){const s=`fail to post ${t} ${n.status}'`,a=new Error(s);return a.status=n.status,a.method="post",a.url=t,a}function j(t){const e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch(n){return e}}function L(t){if("undefined"===typeof XMLHttpRequest)return;const e=new XMLHttpRequest,n=t.action;e.upload&&(e.upload.onprogress=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.onProgress(e)});const s=new FormData;t.data&&Object.keys(t.data).map(e=>{s.append(e,t.data[e])}),s.append(t.filename,t.file),e.onerror=function(e){t.onError(e)},e.onload=function(){if(e.status<200||e.status>=300)return t.onError(P(n,t,e),j(e));t.onSuccess(j(e))},e.open("post",n,!0),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);const a=t.headers||{};for(let i in a)a.hasOwnProperty(i)&&null!==a[i]&&e.setRequestHeader(i,a[i]);e.send(s)}var $=n("2507"),D=n("9f81"),E="ivu-upload",z={name:"Upload",mixins:[$["a"],D["a"]],components:{UploadList:I},props:{action:{type:String,required:!0},headers:{type:Object,default:function(){return{}}},multiple:{type:Boolean,default:!1},data:{type:Object},name:{type:String,default:"file"},withCredentials:{type:Boolean,default:!1},showUploadList:{type:Boolean,default:!0},type:{type:String,validator:function(t){return Object(v["g"])(t,["select","drag"])},default:"select"},format:{type:Array,default:function(){return[]}},accept:{type:String},maxSize:{type:Number},beforeUpload:Function,onProgress:{type:Function,default:function(){return{}}},onSuccess:{type:Function,default:function(){return{}}},onError:{type:Function,default:function(){return{}}},onRemove:{type:Function,default:function(){return{}}},onPreview:{type:Function,default:function(){return{}}},onExceededSize:{type:Function,default:function(){return{}}},onFormatError:{type:Function,default:function(){return{}}},defaultFileList:{type:Array,default:function(){return[]}},paste:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{prefixCls:E,dragOver:!1,fileList:[],tempIndex:1}},computed:{classes:function(){var t;return["".concat(E),(t={},Object(d["a"])(t,"".concat(E,"-select"),"select"===this.type),Object(d["a"])(t,"".concat(E,"-drag"),"drag"===this.type),Object(d["a"])(t,"".concat(E,"-dragOver"),"drag"===this.type&&this.dragOver),t)]}},methods:{handleClick:function(){this.itemDisabled||this.$refs.input.click()},handleChange:function(t){var e=t.target.files;e&&(this.uploadFiles(e),this.$refs.input.value=null)},onDrop:function(t){this.dragOver=!1,this.itemDisabled||this.uploadFiles(t.dataTransfer.files)},handlePaste:function(t){this.itemDisabled||this.paste&&this.uploadFiles(t.clipboardData.files)},uploadFiles:function(t){var e=this,n=Array.prototype.slice.call(t);this.multiple||(n=n.slice(0,1)),0!==n.length&&n.forEach((function(t){e.upload(t)}))},upload:function(t){var e=this;if(!this.beforeUpload)return this.post(t);var n=this.beforeUpload(t);n&&n.then?n.then((function(n){"[object File]"===Object.prototype.toString.call(n)?e.post(n):e.post(t)}),(function(){})):!1!==n&&this.post(t)},post:function(t){var e=this;if(this.format.length){var n=t.name.split(".").pop().toLocaleLowerCase(),s=this.format.some((function(t){return t.toLocaleLowerCase()===n}));if(!s)return this.onFormatError(t,this.fileList),!1}if(this.maxSize&&t.size>1024*this.maxSize)return this.onExceededSize(t,this.fileList),!1;this.handleStart(t);var a=new FormData;a.append(this.name,t),L({headers:this.headers,withCredentials:this.withCredentials,file:t,data:this.data,filename:this.name,action:this.action,onProgress:function(n){e.handleProgress(n,t)},onSuccess:function(n){e.handleSuccess(n,t)},onError:function(n,s){e.handleError(n,s,t)}})},handleStart:function(t){t.uid=Date.now()+this.tempIndex++;var e={status:"uploading",name:t.name,size:t.size,percentage:0,uid:t.uid,showProgress:!0};this.fileList.push(e)},getFile:function(t){var e,n=this.fileList;return n.every((function(n){return e=t.uid===n.uid?n:null,!e})),e},handleProgress:function(t,e){var n=this.getFile(e);this.onProgress(t,n,this.fileList),n.percentage=t.percent||0},handleSuccess:function(t,e){var n=this.getFile(e);n&&(n.status="finished",n.response=t,this.onSuccess(t,n,this.fileList),this.dispatch("FormItem","on-form-change",n),setTimeout((function(){n.showProgress=!1}),1e3))},handleError:function(t,e,n){var s=this.getFile(n),a=this.fileList;s.status="fail",a.splice(a.indexOf(s),1),this.onError(t,e,n)},handleRemove:function(t){var e=this.fileList;e.splice(e.indexOf(t),1),this.onRemove(t,e)},handlePreview:function(t){"finished"===t.status&&this.onPreview(t)},clearFiles:function(){this.fileList=[]}},watch:{defaultFileList:{immediate:!0,handler:function(t){var e=this;this.fileList=t.map((function(t){return t.status="finished",t.percentage=100,t.uid=Date.now()+e.tempIndex++,t}))}}}},T=z,U=Object(x["a"])(T,l,u,!1,null,null,null),N=U.exports,B=N,R=n("2f62"),A=Object(R["a"])("../../../store/modules"),M=A.mapActions,W={name:"UploadPlugin",props:{sourceType:{type:String,default:"image"},width:{type:[String,Number],default:"200px"},height:{type:[String,Number],default:"200px"},accept:{type:String,default:""},format:{type:Array,default:function(){return[]}},needPreview:{type:Boolean,default:!1},cover:{type:String,default:""}},components:{Upload:B,Icon:c["a"],Tooltip:r["a"]},computed:{bgType:function(){return this.$store.state.bgType},bg:function(){return this.$store.state.bg},converterCardStyles:function(){return"image"!=this.bgType&&this.bg?{backgroundColor:this.$lightenOrDarken(this.bg,-10)}:{backgroundColor:"#fff"}},resultStyles:function(){return"image"!=this.bgType&&this.bg?{backgroundColor:this.$lightenOrDarken(this.bg,-20)}:{backgroundColor:"#fff"}},containerStyles:function(){return{width:isNaN(this.width)?this.width:this.width+"px",height:isNaN(this.height)?this.height:this.height+"px"}}},data:function(){return{formData:{maxSize:204800,format:["jpg","png","jpeg","gif"]},currentPlugin:"",currentFileName:"",cachedFile:null,fileUrl:"",audioInfo:{}}},watch:{format:{immediate:!0,handler:function(t){this.formData.format=t}}},methods:Object(o["a"])(Object(o["a"])({},M(["moduleConverter"])),{},{beforeUpload:function(t){var e=this;return Object(i["a"])(regeneratorRuntime.mark((function n(){var s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.cachedFile=t,"image"!==e.sourceType){n.next=6;break}e.fileUrl=e.$getFileURL(t),e.$emit("change",{sourceType:e.sourceType,file:e.cachedFile}),n.next=12;break;case 6:if("audio"!==e.sourceType){n.next=12;break}return n.next=9,e.$store.dispatch("moduleConverter/getAudioInfoFromLocal",{accept:"mp3;wav;flac;ogg;aac;m4a;wma;au;aiff;opus;amr",file:t});case 9:s=n.sent,s&&200==s.status&&s.data&&200==s.data.status&&s.data.data?e.audioInfo=s.data.data:e.audioInfo={status:1001,message:"失败",data:null},e.$emit("change",{sourceType:e.sourceType,info:e.audioInfo,file:t});case 12:return n.abrupt("return",!1);case 13:case"end":return n.stop()}}),n)})))()},uploadSuccess:function(t,e,n){200!==t.status||this.$emit("success",{filename:e.name,path:t.data.path,file:this.cachedFile})},uploadFail:function(t,e,n){console.log("uploadFail",t.message),this.$emit("fail",{filename:e.name,message:t.message})},handleMaxSize:function(t){console.log("文件不能超过"+this.formData.maxSize/1024+"M"),this.$emit("fail",{filename:t.name,message:"文件不能超过"+this.formData.maxSize/1024+"M"})},handleFormatError:function(t){this.$Notice.error({title:"格式错误",desc:"请上传"+this.formData.format.join("; ")+"格式的文件"})},downloadCover:function(t){t.stopPropagation(),this.$downloadImage(this.audioInfo.cover)}})},q=W,H=(n("7842"),n("5945")),J=Object(x["a"])(q,s,a,!1,null,"3af99dee",null);"function"===typeof H["default"]&&Object(H["default"])(J);e["default"]=J.exports}}]);
//# sourceMappingURL=chunk-18c21991.f7bcf4f9.js.map